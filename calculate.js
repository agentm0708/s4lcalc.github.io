var formatter = new Intl.NumberFormat("en-US", {
  style: "decimal",
  minimumFractionDigits: 2,
  maximumFractionDigits: 2,
});

// L1
var b71 = 0;
var b72 = 0;
var b73 = 400000;
var a75 = 0;
var f75 = 0;
var l75 = 0;

// L2
var f78 = 0;
var d79 = 0;
var f79 = 0;
var l79 = 400000;
var d80 = 0;
var f83 = 0;
var a84 = 0;
var f84 = 0;
var l84 = 0;

// L3
var f87 = 0;
var d88 = 0;
var f88 = 0;
var l88 = 400000;
var d89 = 0;
var f92 = 0;
var a93 = 0;
// var f93 = 0;
var l93 = 0;

// L4
var f96 = 0;
var d97 = 0;
var f97 = 0;
var l97 = 400000;
var d98 = 0;
var f92 = 0;
var a93 = 0;
var l93 = 0;

// L5
var f146 = 0;
var d147 = 0;
var f147 = 0;
var l147 = 400000;
var d148 = 0;
var f151 = 0;
var a152 = 0;
var l152 = 0;

var k71 = 0;

//
const data = [
 

  [0.0, 0.0, 0.0, 0.0, 7.0, 5.0, 5.0, 3.0, 3.0],
  [1.07143, 100000.0, 1071.43, 1070.0, 75.0, 53.57, 53.57, 32.14, 32.14],
  [0.71429, 150000.0, 1071.43, 1070.0, 75.0, 53.57, 53.57, 32.14, 32.14],
  [0.53572, 200000.0, 1071.43, 1070.0, 75.0, 53.57, 53.57, 32.14, 32.14],
  [0.42857, 250000.0, 1071.43, 1070.0, 75.0, 53.57, 53.57, 32.14, 32.14],
  [0.35714, 300000.0, 1071.43, 1070.0, 75.0, 53.57, 53.57, 32.14, 32.14],
  [0.61225, 350000.0, 2142.86, 1070.0, 150.0, 107.14, 107.14, 64.29, 64.29],
  [0.53572, 400000.0, 2142.86, 1070.0, 150.0, 107.14, 107.14, 64.29, 64.29],
  [0.47619, 450000.0, 2142.86, 1070.0, 150.0, 107.14, 107.14, 64.29, 64.29],
  [0.42857, 500000.0, 2142.86, 1070.0, 150.0, 107.14, 107.14, 64.29, 64.29],
  [0.38961, 550000.0, 2142.86, 1070.0, 150.0, 107.14, 107.14, 64.29, 64.29],
  [0.35714, 600000.0, 2142.86, 1070.0, 150.0, 107.14, 107.14, 64.29, 64.29],
  [0.54945, 650000.0, 3571.43, 1070.0, 250.0, 178.57, 178.57, 107.14, 107.14],
  [0.51020, 700000.0, 3571.43, 1070.0, 250.0, 178.57, 178.57, 107.14, 107.14],
  [0.47619, 750000.0, 3571.43, 1070.0, 250.0, 178.57, 178.57, 107.14, 107.14],
  [0.44643, 800000.0, 3571.43, 1070.0, 250.0, 178.57, 178.57, 107.14, 107.14],
  [0.42017, 850000.0, 3571.43, 1070.0, 250.0, 178.57, 178.57, 107.14, 107.14],
  [0.39683, 900000.0, 3571.43, 1070.0, 250.0, 178.57, 178.57, 107.14, 107.14],
  [0.49624, 950000.0, 4714.29, 1070.0, 330.0, 235.71, 235.71, 141.43, 141.43],
  [0.47143, 1000000.0, 4714.29, 1070.0, 330.0, 235.71, 235.71, 141.43, 141.43],
  [0.44898, 1050000.0, 4714.29, 1070.0, 330.0, 235.71, 235.71, 141.43, 141.43],
  [0.42857, 1100000.0, 4714.29, 1070.0, 330.0, 235.71, 235.71, 141.43, 141.43],

  [0.40994, 1150000.0, 4714.29, 1070.0, 330.0, 235.71, 235.71, 141.43, 141.43],
  [0.39286, 1200000.0, 4714.29, 1070.0, 330.0, 235.71, 235.71, 141.43, 141.43],
  [0.44571, 1250000.0, 5571.43, 1070.0, 390.0, 278.57, 278.57, 167.14, 167.14],
  [0.42857, 1300000.0, 5571.43, 1070.0, 390.0, 278.57, 278.57, 167.14, 167.14],
  [0.41270, 1350000.0, 5571.43, 1070.0, 390.0, 278.57, 278.57, 167.14, 167.14],
  [0.39796, 1400000.0, 5571.43, 1070.0, 390.0, 278.57, 278.57, 167.14, 167.14],
  [0.38424, 1450000.0, 5571.43, 1070.0, 390.0, 278.57, 278.57, 167.14, 167.14],
  [0.37143, 1500000.0, 5571.43, 1070.0, 390.0, 278.57, 278.57, 167.14, 167.14],
  [0.41475, 1550000.0, 6428.57, 1070.0, 450.0, 321.43, 321.43, 192.86, 192.86],
  [0.40179, 1600000.0, 6428.57, 1070.0, 450.0, 321.43, 321.43, 192.86, 192.86],
  [0.38961, 1650000.0, 6428.57, 1070.0, 450.0, 321.43, 321.43, 192.86, 192.86],
  [0.37815, 1700000.0, 6428.57, 1070.0, 450.0, 321.43, 321.43, 192.86, 192.86],
  [0.36735, 1750000.0, 6428.57, 1070.0, 450.0, 321.43, 321.43, 192.86, 192.86],
  [0.35714, 1800000.0, 6428.57, 1070.0, 450.0, 321.43, 321.43, 192.86, 192.86],
  [0.40541, 1850000.0, 7500.0, 1070.0, 525.0, 375.0, 375.0, 225.0, 225.0],
  [0.39474, 1900000.0, 7500.0, 1070.0, 525.0, 375.0, 375.0, 225.0, 225.0],
  [0.38462, 1950000.0, 7500.0, 1070.0, 525.0, 375.0, 375.0, 225.0, 225.0],
  [0.37500, 2000000.0, 7500.0, 1070.0, 525.0, 375.0, 375.0, 225.0, 225.0],
  [0.36585, 2050000.0, 7500.0, 1070.0, 525.0, 375.0, 375.0, 225.0, 225.0],
  [0.35714, 2100000.0, 7500.0, 1070.0, 525.0, 375.0, 375.0, 225.0, 225.0],
  [0.43189, 2150000.0, 9285.71, 1070.0, 650.0, 464.29, 464.29, 278.57, 278.57],
  [0.42208, 2200000.0, 9285.71, 1070.0, 650.0, 464.29, 464.29, 278.57, 278.57],
  [0.41270, 2250000.0, 9285.71, 1070.0, 650.0, 464.29, 464.29, 278.57, 278.57],
  [0.40373, 2300000.0, 9285.71, 1070.0, 650.0, 464.29, 464.29, 278.57, 278.57],
  [0.39514, 2350000.0, 9285.71, 1070.0, 650.0, 464.29, 464.29, 278.57, 278.57],

  [0.38690, 2400000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.37901, 2450000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.37143, 2500000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.36415, 2550000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.35714, 2600000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.35040, 2650000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.34392, 2700000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.33766, 2750000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.33163, 2800000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.32581, 2850000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.32020, 2900000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.31477, 2950000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.30952, 3000000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.30445, 3050000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.29954, 3100000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.29478, 3150000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.29018, 3200000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.28571, 3250000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.28139, 3300000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.27719, 3350000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.27311, 3400000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.26915, 3450000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.26531, 3500000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.26157, 3550000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
  [0.25794, 3600000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],

  [0.25440, 3650000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.25097, 3700000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.24762, 3750000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.24436, 3800000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.24119, 3850000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.23810, 3900000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.23508, 3950000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.23214, 4000000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.22928, 4050000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.22648, 4100000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.22375, 4150000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.22109, 4200000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.21849, 4250000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.21595, 4300000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.21346, 4350000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.21104, 4400000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.20867, 4450000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.20635, 4500000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.20408, 4550000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.20186, 4600000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.19969, 4650000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.19757, 4700000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.19549, 4750000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.19345, 4800000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.19146, 4850000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],

    [0.18950, 4900000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.18759, 4950000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],
    [0.18571, 5000000.0, 9285.71, 1070.0, 650.00, 464.29, 464.29, 278.57, 278.57],

];

// Range Slider main
$("#1_b71, #2_f78, #3_f87, #4_f96, #5_f146").ionRangeSlider({
  min: 0,
  max: 30,
  step: 1,
  from: 0,
  skin: "round",
  onChange: function (data) {
    var sliderId = data.input[0]["id"].split("_")[0];
    let nextTier = document.getElementById("tier_" + (parseInt(sliderId) + 1));
    // let nextSec = document.getElementById("sec_" + (parseInt(sliderId) + 1));

    if (parseInt(data.from) > 0) {
      // Show the next tier when the value is greater than 0
      if (nextTier) {
        nextTier.style.display = "flex";
      }

      //
    } else {
      // Hide the next tier when the value is 0
      if (nextTier) {
        nextTier.style.display = "none";
        // nextSec.style.display = "none";
      }
    }

    if (sliderId == "1") {
      $("#2_f78").data("ionRangeSlider").update({
        max: data.from,
      });
    }

    document.getElementById("input_agent_" + sliderId).value = data.from;
    calculate();
  },
});

// Agents
$("#d79, #d88, #d97, #d147").ionRangeSlider({
  min: 0,
  max: 30,
  step: 1,
  from: 0,
  skin: "round",
  // grid: true,
  // grid_num: 5,
  onChange: function (data) {
    //
    var sliderId = data.input[0]["id"];
    document.getElementById("input_" + sliderId).value = data.from;

    if (sliderId == "d79") {
      $("#3_f87").data("ionRangeSlider").update({
        max: data.from,
      });
    }

    if (sliderId == "d88") {
      $("#4_f96").data("ionRangeSlider").update({
        max: data.from,
      });
    }

    if (sliderId == "d97") {
      $("#5_f146").data("ionRangeSlider").update({
        max: data.from,
      });
    }

    calculate();
  },
});

// Transactions
$("#b72, #f79 , #f88, #f97, #f147").ionRangeSlider({
  min: 0,
  max: 20,
  step: 1,
  from: 0,
  skin: "round",
  onChange: function (data) {
    //
    var sliderId = data.input[0]["id"];
    document.getElementById("input_" + sliderId).value = data.from;

    calculate();
  },
});

//  Price
$("#b73, #l79, #l88, #l97, #l147").ionRangeSlider({
  min: 400000,
  max: 5000000,
  step: 50000,
  from: 400000,
  skin: "round",
  // grid: true,
  // grid_num: 5,
  onChange: function (data) {
    //
    //
    var sliderId = data.input[0]["id"];
    document.getElementById("input_" + sliderId).value =
      data.from.toLocaleString() + ".00";

    //
    data.input[0]["id"] === "b73" ? (b73 = data.from) : "";
    data.input[0]["id"] === "l79" ? (l79 = data.from) : "";
    data.input[0]["id"] === "l88" ? (l88 = data.from) : "";
    data.input[0]["id"] === "l97" ? (l97 = data.from) : "";
    data.input[0]["id"] === "l147" ? (l147 = data.from) : "";

    //
    calculate();
  },
});

// Function for calculation
function calculate() {
  k71 = 0;

  // L1
  b71 = 0;
  b72 = 0;
  a75 = 0;
  f75 = 0;
  l75 = 0;

  // L2
  f78 = 0;
  d79 = 0;
  f79 = 0;
  d80 = 0;
  f83 = 0;
  a84 = 0;
  f84 = 0;
  l84 = 0;

  // L3
  f87 = 0;
  d88 = 0;
  f88 = 0;
  d89 = 0;
  f92 = 0;
  a93 = 0;
  l93 = 0;

  // L4
  f96 = 0;
  d97 = 0;
  f97 = 0;
  d89 = 0;
  f92 = 0;
  a93 = 0;
  l93 = 0;

  // L5
  f146 = 0;
  d147 = 0;
  f147 = 0;
  d148 = 0;
  f151 = 0;
  a152 = 0;
  l152 = 0;

  // Level 1
  b71 = parseFloat(document.getElementById("1_b71").value) || 0;
  b72 = parseFloat(document.getElementById("b72").value) || 0;

  a75 = b71 + 1;
  document.getElementById("a75").innerText = a75;

  f75 = b71 * b72 * data.find((row) => row[1] === b73)?.[4];
  document
    .querySelectorAll(".f75")
    .forEach((div) => (div.textContent = "$ " + formatter.format(f75)));

  l75 = b71 * b72;
  document.getElementById("l75").innerText = l75;

  // Level 2
  f78 = parseFloat(document.getElementById("2_f78").value) || 0;
  d79 = parseFloat(document.getElementById("d79").value) || 0;
  f79 = parseFloat(document.getElementById("f79").value) || 0;

  d80 = f78 * d79;
  document.getElementById("d80").innerText = d80;

  //
  f83 = d79 * f78 * d79 * data.find((row) => row[1] === l79)?.[5];
  document
    .querySelectorAll(".f83")
    .forEach((div) => (div.textContent = "$ " + formatter.format(f83)));

  a84 = a75 + d79 * f78;
  document.getElementById("a84").innerText = a84;

  // f84 = f83 + f75;
  // document.getElementById("f84").innerText = "$ " + Math.round(f84 * 100) / 100;

  l84 = l75 + d79 * f79 * f78;
  document.getElementById("l84").innerText = l84;

  // Level 3
  f87 = parseFloat(document.getElementById("3_f87").value) || 0;
  d88 = parseFloat(document.getElementById("d88").value) || 0;
  f88 = parseFloat(document.getElementById("f88").value) || 0;

  d89 = f87 * d88;
  document.getElementById("d89").innerText = d89;

  f92 = f88 * d88 * f87 * data.find((row) => row[1] === l88)?.[6];

  document
    .querySelectorAll(".f92")
    .forEach((div) => (div.textContent = "$ " + formatter.format(f92)));

  a93 = a84 + d88 * f87;
  document.getElementById("a93").innerText = a93;

  l93 = l84 + d88 * f88 * f87;
  document.getElementById("l93").innerText = l93;

  // Level 4
  f96 = parseFloat(document.getElementById("4_f96").value) || 0;
  d97 = parseFloat(document.getElementById("d97").value) || 0;
  f97 = parseFloat(document.getElementById("f97").value) || 0;

  d98 = f96 * d97;
  document.getElementById("d98").innerText = d98;

  f101 = f97 * d97 * f96 * data.find((row) => row[1] === l97)?.[7];

  document
    .querySelectorAll(".f101")
    .forEach((div) => (div.textContent = "$ " + formatter.format(f101)));

  a102 = a93 + d97 * f96;
  document.getElementById("a102").innerText = a102;

  l102 = l93 + d97 * f97 * f96;
  document.getElementById("l102").innerText = l102;

  //
  // Level 5

  f146 = parseFloat(document.getElementById("5_f146").value) || 0;
  d147 = parseFloat(document.getElementById("d147").value) || 0;
  f147 = parseFloat(document.getElementById("f147").value) || 0;

  d148 = f146 * d147;
  document.getElementById("d148").innerText = d148;

  f151 = f147 * d88 * d147 * data.find((row) => row[1] === l147)?.[7];

  document
    .querySelectorAll(".f151")
    .forEach((div) => (div.textContent = "$ " + formatter.format(f151)));

  a152 = a93 + d147 * f146;
  document.getElementById("a152").innerText = a152;

  l152 = l102 + d147 * f147 * f146;
  document.getElementById("l152").innerText = l152;

  //

  // Total Summary
  k71 = f75 + f83 + f92 + f101 + f151;
  document
    .querySelectorAll(".k71")
    .forEach((div) => (div.textContent = "$ " + formatter.format(k71)));
}